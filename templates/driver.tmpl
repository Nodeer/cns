<!DOCTYPE html>
<html lang="en">
    <head>

        {{ template "head.tmpl" . }}

        <!-- sweet alerts -->
        <link href="/static/sweet-alert/sweet-alert.min.css" rel="stylesheet">
        <link href="/static/dropzone/dropzone.css" rel="stylesheet" type="text/css" />
        <!-- DataTables -->
        <link href="/static/datatables/data-tables-bootstrap.css" rel="stylesheet" type="text/css" />

    </head>

    <body>

        {{ template "side-nav.tmpl" . }}

        <!--Main Content Start -->
        <section class="content">

            {{ template "nav.tmpl" . }}

            <div class="wraper container-fluid">
                    <div class="col-sm-12">

                        {{ template "alerts.tmpl" . }}

                        <div class="panel panel-default p-0">
                            <div class="panel-body p-0">
                                <ul class="nav nav-tabs profile-tabs">
                                    <li class="active"><a data-toggle="tab" href="#info">Information</a></li>
                                    <li class=""><a data-toggle="tab" href="#forms">Forms</a></li>
                                    <li class=""><a data-toggle="tab" href="#files">Uploaded Files</a></li>
                                    <li class=""><a data-toggle="tab" href="#settings">Settings</a></li>
                                </ul>

                                <div class="tab-content m-0">

                                    <div id="info" class="tab-pane active">
                                        <div class="profile-desk">
                                            <h1>{{ .driver.FirstName }} {{ .driver.LastName}}</h1>

                                            <table class="table table-condensed">
                                                <tbody>
                                                    <tr>
                                                        <td><b>Email</b></td>
                                                        <td>{{ .driver.Email }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Phone</b></td>
                                                        <td>{{ .driver.Phone }}</td>
                                                    </tr>

                                                    <tr>
                                                        <td><b>Address</b></td>
                                                        <td>{{ .driver.AddrHTML }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Date of Birth</b></td>
                                                        <td>{{ .driver.FormatDOB }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td><b>Age</b></td>
                                                        <td>{{ .driver.GetAge }}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div id="forms" class="tab-pane">
                                        <div class="row m-t-10">
                                            <div class="col-md-12">

                                            </div>
                                        </div>
                                    </div>

                                    <!-- profile -->
                                    <div id="files" class="tab-pane">
                                        <div class="row m-t-10">
                                            <div class="col-lg-6">

                                                <div class="table-responsive">
                                                    <table id="file" class="table table-bordered">
                                                        <thead>
                                                            <tr>
                                                                <th>Name</th>
                                                                <th>Size</th>
                                                                <th></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {{ $driver := .driver }}
                                                            {{ range $file := .files }}
                                                                <tr>
                                                                    <td>{{ $file }}</td>
                                                                    <td></td>
                                                                    <td><a href="/driver/file/{{ $driver.Id }}/{{ $file }}" target="_blank">View</a><br></td>
                                                                </tr>
                                                            {{ end }}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="col-lg-6">
                                                <form action="/driver/upload" method="post" class="dropzone" id="dropzone">
                                                    <div class="fallback">
                                                        <input name="file" type="file" multiple />
                                                    </div>
                                                    <input type="hidden" name="id" value="{{ .driver.Id }}">
                                                </form>

                                            </div>
                                        </div>
                                    </div>

                                    <!-- settings -->
                                    <div id="settings" class="tab-pane">
                                        <div class="user-profile-content">
                                            <form role="form" action="/driver/{{ .driver.Id }}" method="post">
                                                <div class="row">
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <label>First Name</label>
                                                            <input type="text" value="{{ .driver.FirstName }}" name="firstName" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Last Name</label>
                                                            <input type="text" value="{{ .driver.LastName }}" name="lastName" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Email</label>
                                                            <input type="email" value="{{ .driver.Email }}" name="email" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Date of Birth</label>
                                                            <input type="date" value="{{ .driver.DOB }}" name="dOB" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>License Number</label>
                                                            <input type="text" value="{{ .driver.LicenseNum }}" name="LicenseNum" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>License State</label>
                                                            <input type="text" value="{{ .driver.LicenseState }}" name="licenseState" class="form-control">
                                                        </div>
                                                    </div>
                                                    <div class="col-lg-6">
                                                        <div class="form-group">
                                                            <label>Street</label>
                                                            <input type="text" value="{{ .driver.Street }}" name="address.Street" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>City</label>
                                                            <input type="text" value="{{ .driver.City }}" name="address.City" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>State</label>
                                                            <input type="text" value="{{ .driver.State }}" name="address.City" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Zip</label>
                                                            <input type="text" value="{{ .driver.Zip }}" name="address.Zip" class="form-control">
                                                        </div>
                                                        <div class="form-group">
                                                            <label>Phone</label>
                                                            <input type="text" value="{{ .driver.Phone }}" name="phone" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                                <button class="btn btn-primary" type="submit">Save</button>
                                            </form>
                                            <br>

                                            <form action="/driver/upload" method="post" class="dropzone" id="settingsDropzone">
                                                <div class="fallback">
                                                    <input name="file" type="file" multiple />
                                                </div>
                                                <input type="hidden" name="id" value="{{ .driver.Id }}">
                                            </form>

                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
            </div>

            {{ template "footer.tmpl" . }}

        </section>

        {{ template "scripts.tmpl" . }}

        <script src="/static/js/jquery.scrollTo.min.js"></script>
        <script src="/static/dropzone/dropzone.min.js"></script>
        <script src="/static/datatables/jquery.dataTables.min.js"></script>
        <script src="/static/datatables/dataTables.bootstrap.js"></script>

        <script>
            Dropzone.options.dropzone = false;
            var myDropzone = new Dropzone('#dropzone', {
                addRemoveLinks: true,
                createImageThumbnails: false,
                filesixeBase: 1024,
                init: function() {
                    this.on('success', function(file, msg) {
                        if (msg.status !== 'success')  {
                            alert('error');
                            return
                        }
                        //alert('Successfully uploaded ' + file.name);
                        $.ajax({
                            url: '/api/upload?path=upload/driver/{{ .driver.Id }}',
                            success: function(d) {
                                renderFiles(d);
                                //displayFiles(d)
                            },
                            error: function(d) {
                                alert('error');
                            }
                        });
                    });
                    this.on('removedfile', function(file) {
                        alert(file.name);
                    });
                },
            });


            function renderFiles(files) {
                /*var fileTable = $('table#files tbody');
                fileTable.html('');
                console.log(files);
                for (var i = 0; i < files.length; i++) {
                    var row = $('<tr>'+
                        '<td>' + files[i].name + '</td>'+
                        '<td></td>'+
                        '<td><a href="/driver/file/{{ .driver.Id }}/' + files[i].name + '" target="_blank">View</a><br></td>'+
                    '</tr>');
                    fileTable.append(row);
                }*/
                dataTable.rows('tbody tr').remove();
                for (var i = 0; i < files.length; i++) {
                    dataTable.row.add([
                        files[i].name,
                        '',
                        '<a href="/driver/file/{{ .driver.Id }}/' + files[i].name + '" target="_blank">View</a>'
                    ]);
                }
                dataTable.draw();
            }

            function displayFiles() {
                $.ajax({
                    url: '/api/upload?path=upload/driver/{{ .driver.Id }}',
                    success: function(d) {
                        setFiles(d);
                    },
                    error: function(d) {
                        alert('error');
                    }
                })
            }

            function setFiles(files) {
                $('#previews').html('');
                for (var i = 0; i < files.length; i++) {
                    myDropzone.emit("addedfile", files[i]);
                    myDropzone.emit("complete", files[i]);
                }
            }
            //displayFiles();
            var dataTable = $('#file').DataTable({
                lengthMenu:[5,10,15,20]
            });
        </script>

    </body>
</html>
